<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SCR-K-004 — 연결 완료 화면</title>
  <link rel="preconnect" href="https://cdn.jsdelivr.net">
  <link href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css" rel="stylesheet">
  <style>
    /* ─────────────────────────────────────────────
       Design Tokens (공통 설계 문서 기반)
       ───────────────────────────────────────────── */
    :root {
      /* Primary — K7 Store Green (TBD-UI-002 가정값) */
      --primary: #008062;
      --primary-hover: #006B52;
      --primary-active: #005642;
      --primary-soft: #E6F5F0;

      /* Status */
      --success: #22C55E;
      --warning: #F59E0B;
      --error: #EF4444;
      --info: #3B82F6;

      /* Backgrounds */
      --bg-panel: #FFFFFF;
      --bg-card-footer: #F8FAFC;
      --bg-info-message: #EFF6FF;
      --bg-avatar-bubble: #F0F5FF;
      --bg-e2ee-badge: #F0FDF4;

      /* Text */
      --text-primary: #1E293B;
      --text-secondary: #64748B;
      --text-inactive: #CBD5E1;

      /* Border */
      --border-default: #E2E8F0;
      --border-hover: #CBD5E1;
      --border-pressed: #94A3B8;

      /* Dim Overlay */
      --dim-overlay: rgba(0, 0, 0, 0.35);

      /* Shadow Levels */
      --shadow-0: none;
      --shadow-1: 0 1px 3px rgba(0, 0, 0, 0.08);
      --shadow-2: 0 4px 12px rgba(0, 0, 0, 0.12);
      --shadow-3: 0 8px 32px rgba(0, 0, 0, 0.20);

      /* Radius */
      --radius-sm: 4px;
      --radius-md: 8px;
      --radius-lg: 10px;
      --radius-xl: 16px;

      /* Spacing */
      --space-1: 4px;
      --space-2: 8px;
      --space-3: 12px;
      --space-4: 16px;
      --space-5: 20px;
      --space-6: 24px;

      /* Font */
      --font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;

      /* Annotation Colors */
      --ann-red: #EF4444;
      --ann-blue: #3B82F6;
      --ann-green: #22C55E;
      --ann-orange: #F59E0B;
      --ann-purple: #8B5CF6;
      --ann-cyan: #06B6D4;
    }

    /* ─────────────────────────────────────────────
       Reset & Base
       ───────────────────────────────────────────── */
    *, *::before, *::after {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html, body {
      width: 100%;
      min-height: 100vh;
      overflow-x: auto;
      font-family: var(--font-family);
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      background: #FFFFFF;
    }

    /* ─────────────────────────────────────────────
       Page Layout
       ───────────────────────────────────────────── */
    .page-wrapper {
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
      background: #FFFFFF;
      padding: 32px 24px;
      gap: 24px;
    }

    /* ─────────────────────────────────────────────
       Screen Info Panel
       ───────────────────────────────────────────── */
    .screen-info {
      width: 768px;
      display: flex;
      gap: 16px;
      flex-wrap: wrap;
    }

    .screen-info__card {
      flex: 1;
      min-width: 220px;
      background: #F9FAFB;
      border: 1px solid #E5E7EB;
      border-radius: 10px;
      padding: 16px 18px;
    }

    .screen-info__card-title {
      font-size: 11px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.8px;
      color: #9CA3AF;
      margin-bottom: 10px;
    }

    .screen-info__row {
      display: flex;
      align-items: baseline;
      gap: 8px;
      margin-bottom: 5px;
    }

    .screen-info__row:last-child {
      margin-bottom: 0;
    }

    .screen-info__label {
      font-size: 11px;
      font-weight: 500;
      color: #9CA3AF;
      min-width: 72px;
      flex-shrink: 0;
    }

    .screen-info__value {
      font-size: 12px;
      font-weight: 500;
      color: #374151;
    }

    .screen-info__badge {
      display: inline-block;
      padding: 2px 7px;
      border-radius: 4px;
      font-size: 11px;
      font-weight: 600;
      line-height: 1.4;
    }

    .screen-info__badge--green {
      background: #DCFCE7;
      color: #166534;
    }

    .screen-info__badge--blue {
      background: #DBEAFE;
      color: #1E40AF;
    }

    .screen-info__badge--purple {
      background: #EDE9FE;
      color: #5B21B6;
    }

    .screen-info__badge--amber {
      background: #FEF3C7;
      color: #92400E;
    }

    /* ─────────────────────────────────────────────
       Kiosk Frame — 768×1024
       ───────────────────────────────────────────── */
    .kiosk-frame {
      position: relative;
      width: 768px;
      height: 1024px;
      flex-shrink: 0;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 4px 24px rgba(0, 0, 0, 0.08), 0 0 0 1px rgba(0, 0, 0, 0.06);
    }

    /* ─────────────────────────────────────────────
       Host App Background
       ───────────────────────────────────────────── */
    .host-app {
      position: relative;
      width: 768px;
      height: 1024px;
      background: linear-gradient(180deg, #F0F4F8 0%, #E8ECF0 100%);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }

    .host-app__header {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 64px;
      background: var(--primary);
      display: flex;
      align-items: center;
      padding: 0 24px;
      z-index: 1;
    }

    .host-app__header-logo {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .host-app__header-title {
      font-size: 18px;
      font-weight: 600;
      color: #FFFFFF;
      letter-spacing: -0.2px;
    }

    .host-app__content {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 24px;
      opacity: 0.5;
    }

    .host-app__content-icon {
      width: 80px;
      height: 80px;
      border-radius: 20px;
      background: rgba(0, 128, 98, 0.08);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .host-app__content-text {
      font-size: 16px;
      color: var(--text-secondary);
      text-align: center;
      line-height: 1.5;
    }

    /* ─────────────────────────────────────────────
       Dim Overlay (Z-Index Layer 2)
       ───────────────────────────────────────────── */
    .dim-overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: var(--dim-overlay);
      z-index: 10;
      animation: dimFadeIn 200ms ease-out forwards;
    }

    @keyframes dimFadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    /* ─────────────────────────────────────────────
       Floating Panel (Z-Index Layer 3)
       560 × 720px, 우측 정렬 (우측 20px), 수직 중앙
       ───────────────────────────────────────────── */
    .floating-panel {
      position: absolute;
      width: 560px;
      height: 720px;
      right: 20px;
      top: 50%;
      transform: translateY(-50%);
      background: var(--bg-panel);
      border-radius: var(--radius-xl);
      box-shadow: var(--shadow-3);
      z-index: 20;
      display: flex;
      flex-direction: column;
      overflow: hidden;
      animation: panelExpand 300ms ease-out forwards;
    }

    @keyframes panelExpand {
      from {
        opacity: 0;
        height: 60px;
        transform: translateY(calc(-50% + 330px));
        border-radius: 12px;
      }
      to {
        opacity: 1;
        height: 720px;
        transform: translateY(-50%);
        border-radius: var(--radius-xl);
      }
    }

    /* ─────────────────────────────────────────────
       Panel Header (56px)
       ───────────────────────────────────────────── */
    .panel-header {
      height: 56px;
      min-height: 56px;
      display: flex;
      align-items: center;
      padding: 0 12px 0 16px;
      background: var(--bg-panel);
      border-bottom: 1px solid var(--border-default);
    }

    .panel-header__title {
      font-size: 16px;
      font-weight: 500;
      color: var(--text-primary);
      flex: 1;
      letter-spacing: -0.2px;
    }

    .panel-header__actions {
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .panel-header__icon {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 32px;
      height: 32px;
      border: none;
      background: transparent;
      border-radius: var(--radius-md);
      cursor: pointer;
      transition: background 150ms ease;
    }

    .panel-header__icon:hover {
      background: #F1F5F9;
    }

    /* 보안 아이콘 — SCR-K-004 진입 시 녹색 활성 상태 */
    .panel-header__security {
      width: 16px;
      height: 16px;
      color: var(--success);
    }

    /* 연결 상태 인디케이터 — 녹색 연결됨 상태 */
    .panel-header__connection {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: var(--success);
      margin: 0 6px;
      box-shadow: 0 0 0 3px rgba(34, 197, 94, 0.2);
      animation: connectionPulse 2s ease-in-out infinite;
    }

    @keyframes connectionPulse {
      0%, 100% { box-shadow: 0 0 0 3px rgba(34, 197, 94, 0.2); }
      50% { box-shadow: 0 0 0 5px rgba(34, 197, 94, 0.1); }
    }

    .panel-header__close {
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      border: none;
      background: transparent;
      border-radius: var(--radius-md);
      cursor: pointer;
      color: var(--text-secondary);
      transition: all 150ms ease;
      min-width: 48px;
      min-height: 48px;
    }

    .panel-header__close:hover {
      background: #FEF2F2;
      color: var(--error);
    }

    .panel-header__close:active {
      background: #FEE2E2;
    }

    .panel-header__close svg {
      width: 18px;
      height: 18px;
    }

    /* ─────────────────────────────────────────────
       Panel Content
       ───────────────────────────────────────────── */
    .panel-content {
      flex: 1;
      padding: 12px 20px;
      display: flex;
      flex-direction: column;
      overflow-y: auto;
    }

    /* ─────────────────────────────────────────────
       Avatar Area (Type A — 160px)
       ───────────────────────────────────────────── */
    .avatar-area {
      display: flex;
      align-items: flex-start;
      gap: 12px;
      min-height: 160px;
      padding: 10px 0;
      animation: fadeSlideUp 400ms ease-out 100ms both;
    }

    @keyframes fadeSlideUp {
      from { opacity: 0; transform: translateY(12px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .avatar-container {
      width: 120px;
      min-width: 120px;
      height: 140px;
      border-radius: var(--radius-lg);
      overflow: hidden;
      position: relative;
      flex-shrink: 0;
      cursor: pointer;
    }

    .avatar-placeholder {
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, #E6F5F0 0%, #DBEAFE 50%, #F0F5FF 100%);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      border-radius: var(--radius-lg);
      border: 1px solid var(--border-default);
      position: relative;
      animation: avatarBreathe 3s ease-in-out infinite;
    }

    @keyframes avatarBreathe {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(0.98); }
    }

    .avatar-placeholder__icon {
      width: 56px;
      height: 56px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--primary) 0%, #22D3EE 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 8px;
      box-shadow: 0 4px 16px rgba(0, 128, 98, 0.2);
    }

    .avatar-placeholder__icon svg {
      width: 28px;
      height: 28px;
      color: #FFFFFF;
    }

    .avatar-placeholder__label {
      font-size: 11px;
      font-weight: 500;
      color: var(--text-secondary);
      letter-spacing: 0.2px;
    }

    /* AVT-SPEAK 상태 표시: 말풍선 아이콘 오버레이 */
    .avatar-speak-indicator {
      position: absolute;
      bottom: 6px;
      right: 6px;
      width: 24px;
      height: 24px;
      background: var(--primary);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
      animation: speakPulse 1.5s ease-in-out infinite;
    }

    @keyframes speakPulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.1); }
    }

    .avatar-speak-indicator svg {
      width: 14px;
      height: 14px;
      color: #FFFFFF;
    }

    /* Avatar Speech Bubble */
    .avatar-bubble {
      max-width: 360px;
      min-height: 56px;
      background: var(--bg-avatar-bubble);
      border-radius: 12px 12px 12px 4px;
      padding: 12px 16px;
      position: relative;
      align-self: center;
      animation: bubbleAppear 500ms ease-out 300ms both;
    }

    @keyframes bubbleAppear {
      from { opacity: 0; transform: translateX(-8px) scale(0.96); }
      to { opacity: 1; transform: translateX(0) scale(1); }
    }

    .avatar-bubble::before {
      content: '';
      position: absolute;
      left: -7px;
      top: 20px;
      width: 0;
      height: 0;
      border-top: 6px solid transparent;
      border-bottom: 6px solid transparent;
      border-right: 8px solid var(--bg-avatar-bubble);
    }

    .avatar-bubble__text {
      font-size: 14px;
      font-weight: 400;
      color: var(--text-primary);
      line-height: 1.4;
      word-break: keep-all;
    }

    /* Typing effect for bubble */
    .avatar-bubble__text .typing-cursor {
      display: inline-block;
      width: 2px;
      height: 14px;
      background: var(--primary);
      margin-left: 2px;
      vertical-align: middle;
      animation: blink 0.6s step-end infinite;
    }

    @keyframes blink {
      50% { opacity: 0; }
    }

    /* ─────────────────────────────────────────────
       Content Area — 연결 완료 안내 (440px)
       ───────────────────────────────────────────── */
    .connection-complete {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 0 20px;
      animation: contentFadeIn 500ms ease-out 500ms both;
    }

    @keyframes contentFadeIn {
      from { opacity: 0; transform: translateY(8px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* 완료 아이콘 + 대제목 */
    .connection-complete__header {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 12px;
    }

    .connection-complete__icon {
      width: 48px;
      height: 48px;
      display: flex;
      align-items: center;
      justify-content: center;
      animation: checkBounce 600ms ease-out 700ms both;
    }

    @keyframes checkBounce {
      0% { transform: scale(0); opacity: 0; }
      60% { transform: scale(1.2); }
      100% { transform: scale(1); opacity: 1; }
    }

    .connection-complete__icon svg {
      width: 48px;
      height: 48px;
    }

    .connection-complete__title {
      font-size: 24px;
      font-weight: 700;
      color: var(--text-primary);
      line-height: 1.3;
      letter-spacing: -0.3px;
    }

    /* 설명 텍스트 */
    .connection-complete__desc {
      text-align: center;
      margin-bottom: 16px;
    }

    .connection-complete__desc-line {
      font-size: 16px;
      font-weight: 400;
      color: var(--text-primary);
      line-height: 1.5;
    }

    .connection-complete__desc-line + .connection-complete__desc-line {
      margin-top: 8px;
    }

    /* E2EE 상태 뱃지 */
    .e2ee-badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 12px;
      height: 28px;
      background: var(--bg-e2ee-badge);
      border-radius: var(--radius-sm);
      margin-bottom: 24px;
      animation: badgeFadeIn 400ms ease-out 900ms both;
    }

    @keyframes badgeFadeIn {
      from { opacity: 0; transform: scale(0.9); }
      to { opacity: 1; transform: scale(1); }
    }

    .e2ee-badge__icon {
      width: 14px;
      height: 14px;
      color: var(--success);
    }

    .e2ee-badge__text {
      font-size: 13px;
      font-weight: 500;
      color: var(--success);
      line-height: 1;
    }

    /* 자동 전환 인디케이터 */
    .auto-transition {
      display: flex;
      align-items: center;
      gap: 8px;
      animation: transitionFadeIn 400ms ease-out 1100ms both;
    }

    @keyframes transitionFadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    .auto-transition__dots {
      display: flex;
      gap: 4px;
    }

    .auto-transition__dot {
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background: var(--text-inactive);
    }

    .auto-transition__dot:nth-child(1) {
      animation: dotPulse 1.2s ease-in-out infinite 0ms;
    }
    .auto-transition__dot:nth-child(2) {
      animation: dotPulse 1.2s ease-in-out infinite 200ms;
    }
    .auto-transition__dot:nth-child(3) {
      animation: dotPulse 1.2s ease-in-out infinite 400ms;
    }

    @keyframes dotPulse {
      0%, 100% { background: var(--text-inactive); transform: scale(1); }
      50% { background: var(--text-secondary); transform: scale(1.3); }
    }

    .auto-transition__text {
      font-size: 13px;
      font-weight: 400;
      color: var(--text-secondary);
    }

    /* ─────────────────────────────────────────────
       Reconnection UI (WebRTC 연결 끊김 시)
       ───────────────────────────────────────────── */
    .reconnect-overlay {
      display: none;
      position: absolute;
      top: 56px;
      left: 0;
      right: 0;
      bottom: 52px;
      background: var(--bg-panel);
      z-index: 5;
      flex-direction: column;
      padding: 12px 20px;
    }

    .reconnect-overlay.active {
      display: flex;
    }

    .reconnect-avatar-area {
      display: flex;
      align-items: flex-start;
      gap: 12px;
      min-height: 160px;
      padding: 10px 0;
    }

    .reconnect-content {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 12px;
      padding: 0 20px;
    }

    .reconnect-warning {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 8px;
    }

    .reconnect-warning__icon {
      width: 24px;
      height: 24px;
      color: var(--warning);
    }

    .reconnect-warning__text {
      font-size: 16px;
      font-weight: 600;
      color: var(--text-primary);
    }

    .reconnect-btn {
      width: 100%;
      max-width: 360px;
      height: 48px;
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 0 16px;
      border: 1px solid var(--border-default);
      border-radius: var(--radius-lg);
      background: var(--bg-panel);
      cursor: pointer;
      transition: all 150ms ease;
      font-family: var(--font-family);
      font-size: 15px;
      font-weight: 500;
      color: var(--text-primary);
      min-height: 48px;
      -webkit-tap-highlight-color: transparent;
    }

    .reconnect-btn:hover {
      background: var(--bg-card-footer);
      border-color: var(--border-hover);
      box-shadow: var(--shadow-1);
    }

    .reconnect-btn:active {
      background: #F1F5F9;
      border-color: var(--border-pressed);
    }

    .reconnect-btn__icon {
      font-size: 18px;
      width: 24px;
      text-align: center;
    }

    /* ─────────────────────────────────────────────
       Panel Footer (52px)
       ───────────────────────────────────────────── */
    .panel-footer {
      height: 52px;
      min-height: 52px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 12px 0 16px;
      background: var(--bg-card-footer);
      border-top: 1px solid var(--border-default);
    }

    .panel-footer__left {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .progress-indicator {
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .progress-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: var(--text-inactive);
      transition: all 200ms ease;
    }

    .progress-dot--active {
      background: var(--primary);
      box-shadow: 0 0 0 2px rgba(0, 128, 98, 0.15);
    }

    .progress-label {
      font-size: 12px;
      font-weight: 300;
      color: var(--text-primary);
      margin-left: 2px;
    }

    .btn-fallback {
      display: flex;
      align-items: center;
      gap: 4px;
      padding: 6px 14px;
      min-width: 160px;
      height: 36px;
      border: 1px solid var(--border-hover);
      background: transparent;
      border-radius: var(--radius-md);
      font-family: var(--font-family);
      font-size: 14px;
      font-weight: 500;
      color: var(--text-secondary);
      cursor: pointer;
      transition: all 150ms ease;
      min-height: 48px;
      -webkit-tap-highlight-color: transparent;
      white-space: nowrap;
    }

    .btn-fallback:hover {
      background: var(--bg-panel);
      border-color: var(--border-pressed);
      color: var(--text-primary);
      box-shadow: var(--shadow-1);
    }

    .btn-fallback:active {
      background: #F1F5F9;
    }

    .btn-fallback svg {
      width: 14px;
      height: 14px;
    }

    /* ─────────────────────────────────────────────
       Dimension Annotations
       ───────────────────────────────────────────── */
    .ann-panel-w,
    .ann-panel-h,
    .ann-margin-r,
    .ann-header-h,
    .ann-footer-h,
    .ann-kiosk-w,
    .ann-kiosk-h {
      opacity: 0;
      pointer-events: none;
      transition: opacity 250ms ease;
    }

    .specs-visible .ann-panel-w,
    .specs-visible .ann-panel-h,
    .specs-visible .ann-margin-r,
    .specs-visible .ann-header-h,
    .specs-visible .ann-footer-h,
    .specs-visible .ann-kiosk-w,
    .specs-visible .ann-kiosk-h {
      opacity: 1;
      pointer-events: auto;
    }

    /* 패널 너비 (560px) */
    .ann-panel-w {
      position: absolute;
      z-index: 25;
      right: 20px;
      top: calc(50% - 360px - 22px);
      width: 560px;
      display: flex;
      align-items: center;
      pointer-events: none;
    }

    .ann-panel-w::before,
    .ann-panel-w::after {
      content: '';
      flex: 1;
      height: 1px;
      background: var(--ann-red);
    }

    .ann-panel-w__label {
      padding: 1px 8px;
      font-size: 10px;
      font-weight: 700;
      color: var(--ann-red);
      background: rgba(255,255,255,0.92);
      border-radius: 3px;
      border: 1px solid rgba(239, 68, 68, 0.2);
      white-space: nowrap;
    }

    /* 패널 높이 (720px) */
    .ann-panel-h {
      position: absolute;
      z-index: 25;
      right: 4px;
      top: 50%;
      transform: translateY(-50%);
      height: 720px;
      display: flex;
      flex-direction: column;
      align-items: center;
      pointer-events: none;
    }

    .ann-panel-h::before,
    .ann-panel-h::after {
      content: '';
      flex: 1;
      width: 1px;
      background: var(--ann-blue);
    }

    .ann-panel-h__label {
      padding: 4px 2px;
      font-size: 10px;
      font-weight: 700;
      color: var(--ann-blue);
      background: rgba(255,255,255,0.92);
      border-radius: 3px;
      border: 1px solid rgba(59, 130, 246, 0.2);
      writing-mode: vertical-lr;
      white-space: nowrap;
    }

    /* 우측 여백 (20px) */
    .ann-margin-r {
      position: absolute;
      z-index: 25;
      right: 0;
      top: calc(30% - 7px);
      width: 20px;
      display: flex;
      align-items: center;
      pointer-events: none;
    }

    .ann-margin-r::before,
    .ann-margin-r::after {
      content: '';
      flex: 1;
      height: 1px;
      background: var(--ann-green);
    }

    .ann-margin-r__label {
      position: absolute;
      top: -16px;
      left: 50%;
      transform: translateX(-50%);
      padding: 1px 5px;
      font-size: 9px;
      font-weight: 700;
      color: var(--ann-green);
      background: rgba(255,255,255,0.92);
      border-radius: 3px;
      border: 1px solid rgba(34, 197, 94, 0.2);
      white-space: nowrap;
    }

    /* 헤더 높이 (56px) */
    .ann-header-h {
      position: absolute;
      z-index: 25;
      left: calc(768px - 560px - 20px - 26px);
      top: 50%;
      transform: translateY(calc(-50%));
      pointer-events: none;
    }

    .ann-header-h__line {
      position: absolute;
      top: -360px;
      left: 8px;
      width: 1px;
      height: 56px;
      background: var(--ann-orange);
    }

    .ann-header-h__label {
      position: absolute;
      top: -340px;
      left: -10px;
      padding: 1px 5px;
      font-size: 9px;
      font-weight: 700;
      color: var(--ann-orange);
      background: rgba(255,255,255,0.92);
      border-radius: 3px;
      border: 1px solid rgba(245, 158, 11, 0.2);
      white-space: nowrap;
      writing-mode: vertical-lr;
    }

    /* 푸터 높이 (52px) */
    .ann-footer-h {
      position: absolute;
      z-index: 25;
      left: calc(768px - 560px - 20px - 26px);
      bottom: calc(50% - 360px);
      pointer-events: none;
    }

    .ann-footer-h__line {
      position: absolute;
      bottom: 0;
      left: 8px;
      width: 1px;
      height: 52px;
      background: var(--ann-purple);
    }

    .ann-footer-h__label {
      position: absolute;
      bottom: 10px;
      left: -10px;
      padding: 1px 5px;
      font-size: 9px;
      font-weight: 700;
      color: var(--ann-purple);
      background: rgba(255,255,255,0.92);
      border-radius: 3px;
      border: 1px solid rgba(139, 92, 246, 0.2);
      white-space: nowrap;
      writing-mode: vertical-lr;
    }

    /* 키오스크 전체 크기 */
    .ann-kiosk-w {
      position: absolute;
      z-index: 25;
      left: 0;
      bottom: -22px;
      width: 768px;
      display: flex;
      align-items: center;
      pointer-events: none;
    }

    .ann-kiosk-w::before,
    .ann-kiosk-w::after {
      content: '';
      flex: 1;
      height: 1px;
      background: #9CA3AF;
    }

    .ann-kiosk-w__label {
      padding: 1px 8px;
      font-size: 10px;
      font-weight: 700;
      color: #6B7280;
      background: #FFFFFF;
      border-radius: 3px;
      border: 1px solid #E5E7EB;
      white-space: nowrap;
    }

    .ann-kiosk-h {
      position: absolute;
      z-index: 25;
      left: -22px;
      top: 0;
      height: 1024px;
      display: flex;
      flex-direction: column;
      align-items: center;
      pointer-events: none;
    }

    .ann-kiosk-h::before,
    .ann-kiosk-h::after {
      content: '';
      flex: 1;
      width: 1px;
      background: #9CA3AF;
    }

    .ann-kiosk-h__label {
      padding: 4px 2px;
      font-size: 10px;
      font-weight: 700;
      color: #6B7280;
      background: #FFFFFF;
      border-radius: 3px;
      border: 1px solid #E5E7EB;
      writing-mode: vertical-lr;
      white-space: nowrap;
    }

    /* ─────────────────────────────────────────────
       Confirmation Dialog
       ───────────────────────────────────────────── */
    .dialog-overlay {
      display: none;
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      z-index: 30;
      align-items: center;
      justify-content: center;
    }

    .dialog-overlay.active {
      display: flex;
      animation: dimFadeIn 150ms ease-out;
    }

    .dialog {
      width: 360px;
      background: var(--bg-panel);
      border-radius: var(--radius-xl);
      padding: 28px 24px 20px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.25);
      text-align: center;
      animation: dialogAppear 200ms ease-out;
    }

    @keyframes dialogAppear {
      from { transform: scale(0.92); opacity: 0; }
      to { transform: scale(1); opacity: 1; }
    }

    .dialog__icon {
      width: 48px;
      height: 48px;
      margin: 0 auto 16px;
      border-radius: 50%;
      background: #FEF3C7;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .dialog__title {
      font-size: 18px;
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: 8px;
    }

    .dialog__desc {
      font-size: 14px;
      font-weight: 400;
      color: var(--text-secondary);
      line-height: 1.5;
      margin-bottom: 24px;
    }

    .dialog__actions {
      display: flex;
      gap: 10px;
    }

    .dialog__btn {
      flex: 1;
      height: 44px;
      border-radius: var(--radius-md);
      font-family: var(--font-family);
      font-size: 15px;
      font-weight: 500;
      cursor: pointer;
      transition: all 150ms ease;
      min-height: 48px;
      -webkit-tap-highlight-color: transparent;
    }

    .dialog__btn--secondary {
      background: #F1F5F9;
      border: 1px solid var(--border-default);
      color: var(--text-primary);
    }

    .dialog__btn--secondary:hover {
      background: #E2E8F0;
    }

    .dialog__btn--primary {
      background: var(--primary);
      border: none;
      color: #FFFFFF;
    }

    .dialog__btn--primary:hover {
      background: var(--primary-hover);
    }

    /* ─────────────────────────────────────────────
       Toast Notification
       ───────────────────────────────────────────── */
    .toast {
      position: absolute;
      top: 80px;
      left: 50%;
      transform: translateX(-50%) translateY(-10px);
      background: #1F2937;
      color: #FFFFFF;
      padding: 12px 20px;
      border-radius: var(--radius-lg);
      font-size: 14px;
      font-weight: 500;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.25);
      z-index: 50;
      opacity: 0;
      pointer-events: none;
      transition: all 250ms ease;
      display: flex;
      align-items: center;
      gap: 8px;
      white-space: nowrap;
    }

    .toast.active {
      opacity: 1;
      transform: translateX(-50%) translateY(0);
    }

    /* ─────────────────────────────────────────────
       Accessibility Focus
       ───────────────────────────────────────────── */
    *:focus-visible {
      outline: 3px solid #22D3EE;
      outline-offset: 2px;
    }

    /* ─────────────────────────────────────────────
       Spec Toggle Button
       ───────────────────────────────────────────── */
    .spec-toggle-bar {
      width: 768px;
      display: flex;
      justify-content: flex-end;
      gap: 8px;
      margin-top: -8px;
    }

    .spec-toggle-btn,
    .sim-btn {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 14px;
      height: 32px;
      border: 1px solid #E5E7EB;
      background: #F9FAFB;
      border-radius: 8px;
      font-family: var(--font-family);
      font-size: 12px;
      font-weight: 600;
      color: #6B7280;
      cursor: pointer;
      transition: all 150ms ease;
      letter-spacing: 0.2px;
      user-select: none;
      -webkit-tap-highlight-color: transparent;
    }

    .spec-toggle-btn:hover,
    .sim-btn:hover {
      background: #F1F5F9;
      border-color: #CBD5E1;
      color: #374151;
    }

    .spec-toggle-btn:active,
    .sim-btn:active {
      background: #E2E8F0;
    }

    .spec-toggle-btn svg,
    .sim-btn svg {
      width: 14px;
      height: 14px;
    }

    .sim-btn--danger {
      border-color: #FECACA;
      color: #DC2626;
      background: #FEF2F2;
    }

    .sim-btn--danger:hover {
      background: #FEE2E2;
      border-color: #FCA5A5;
    }

    /* ─────────────────────────────────────────────
       Spec Legend
       ───────────────────────────────────────────── */
    .spec-legend {
      width: 768px;
      display: flex;
      flex-wrap: wrap;
      gap: 12px 24px;
      background: #F9FAFB;
      border: 1px solid #E5E7EB;
      border-radius: 10px;
      opacity: 0;
      max-height: 0;
      overflow: hidden;
      padding: 0 18px;
      margin-top: -24px;
      transition: opacity 250ms ease, max-height 300ms ease, padding 300ms ease, margin-top 300ms ease;
    }

    .spec-legend.visible {
      opacity: 1;
      max-height: 200px;
      padding: 14px 18px;
      margin-top: 0;
    }

    .spec-legend__title {
      width: 100%;
      font-size: 11px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.8px;
      color: #9CA3AF;
      margin-bottom: 2px;
    }

    .spec-legend__item {
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .spec-legend__color {
      width: 12px;
      height: 3px;
      border-radius: 2px;
    }

    .spec-legend__text {
      font-size: 11px;
      font-weight: 500;
      color: #6B7280;
    }

    /* ─────────────────────────────────────────────
       Auto Transition Progress Bar (visual)
       ───────────────────────────────────────────── */
    .transition-progress {
      position: absolute;
      bottom: 52px;
      left: 0;
      right: 0;
      height: 2px;
      background: var(--border-default);
      z-index: 2;
    }

    .transition-progress__bar {
      height: 100%;
      width: 0%;
      background: var(--primary);
      transition: width linear;
    }

    .transition-progress__bar.running {
      width: 100%;
    }
  </style>
</head>
<body>

  <div class="page-wrapper">

    <!-- ═══════════════════════════════════════════
         Screen Info — 키오스크 외부 상단 상시 노출
         ═══════════════════════════════════════════ -->
    <div class="screen-info">
      <!-- 화면 기본 정보 -->
      <div class="screen-info__card">
        <div class="screen-info__card-title">화면 정보</div>
        <div class="screen-info__row">
          <span class="screen-info__label">화면 ID</span>
          <span class="screen-info__value">SCR-K-004</span>
        </div>
        <div class="screen-info__row">
          <span class="screen-info__label">화면명</span>
          <span class="screen-info__value">연결 완료 화면</span>
        </div>
        <div class="screen-info__row">
          <span class="screen-info__label">Phase</span>
          <span class="screen-info__badge screen-info__badge--green">Phase 2 — 세션 페어링 완료</span>
        </div>
      </div>
      <!-- 패널 / 아바타 -->
      <div class="screen-info__card">
        <div class="screen-info__card-title">패널 · 아바타</div>
        <div class="screen-info__row">
          <span class="screen-info__label">패널 모드</span>
          <span class="screen-info__badge screen-info__badge--blue">표준 560 × 720px</span>
        </div>
        <div class="screen-info__row">
          <span class="screen-info__label">아바타</span>
          <span class="screen-info__value">Type A — 상반신 120×140px</span>
        </div>
        <div class="screen-info__row">
          <span class="screen-info__label">Primary</span>
          <span class="screen-info__value" style="display:flex;align-items:center;gap:5px;">
            <span style="width:10px;height:10px;border-radius:3px;background:#008062;display:inline-block;"></span>
            #008062 <span style="color:#9CA3AF">(K7 Green, TBD-UI-002)</span>
          </span>
        </div>
      </div>
      <!-- 참조 문서 -->
      <div class="screen-info__card">
        <div class="screen-info__card-title">설계 참조</div>
        <div class="screen-info__row">
          <span class="screen-info__label">PRD</span>
          <span class="screen-info__badge screen-info__badge--purple">F-002</span>
        </div>
        <div class="screen-info__row">
          <span class="screen-info__label">RSD</span>
          <span class="screen-info__value">REQ-CH-002, REQ-CH-003, REQ-CH-004</span>
        </div>
        <div class="screen-info__row">
          <span class="screen-info__label">인터페이스</span>
          <span class="screen-info__badge screen-info__badge--amber">IF-UI-002</span>
        </div>
        <div class="screen-info__row">
          <span class="screen-info__label">설계서</span>
          <span class="screen-info__value">SCR-K-004 v1.0</span>
        </div>
      </div>
    </div>

    <!-- ═══════════════════════════════════════════
         Toolbar — 규격보기 · 시뮬레이션 토글
         ═══════════════════════════════════════════ -->
    <div class="spec-toggle-bar">
      <button class="sim-btn sim-btn--danger" id="simDisconnectBtn" aria-label="연결 끊김 시뮬레이션">
        <svg viewBox="0 0 20 20" fill="none"><path d="M4 4l12 12M16 4L4 16" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/></svg>
        연결끊김
      </button>
      <button class="sim-btn" id="simResetBtn" aria-label="타이머 리셋">
        <svg viewBox="0 0 20 20" fill="none"><path d="M3 10a7 7 0 0112.9-3.8M17 10a7 7 0 01-12.9 3.8" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/><path d="M16 2v4h-4M4 18v-4h4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
        타이머리셋
      </button>
      <button class="spec-toggle-btn" id="specToggleBtn" aria-label="규격 표시 토글" aria-pressed="false">
        <svg viewBox="0 0 20 20" fill="none">
          <path d="M2 4h4M14 4h4M2 4v2M18 4v2M2 16h4M14 16h4M2 16v-2M18 16v-2M4 2v4M4 14v4M16 2v4M16 14v4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
        </svg>
        규격보기
      </button>
    </div>

    <!-- ═══════════════════════════════════════════
         Kiosk Frame — 768×1024
         ═══════════════════════════════════════════ -->
    <div class="kiosk-frame" id="kioskFrame">
      <div class="host-app" id="hostApp">

        <!-- Host App 헤더 -->
        <div class="host-app__header">
          <div class="host-app__header-logo">
            <span class="host-app__header-title">세븐일레븐 무인 택배 서비스</span>
          </div>
        </div>

        <!-- Host App 콘텐츠 (시뮬레이션) -->
        <div class="host-app__content">
          <div class="host-app__content-icon">
            <svg width="40" height="40" viewBox="0 0 24 24" fill="none">
              <rect x="3" y="6" width="18" height="14" rx="2" stroke="#008062" stroke-width="1.2" opacity="0.4"/>
              <path d="M8 6V4.5C8 3.67 8.67 3 9.5 3h5c.83 0 1.5.67 1.5 1.5V6" stroke="#008062" stroke-width="1.2" opacity="0.4"/>
            </svg>
          </div>
          <div class="host-app__content-text">
            Host App 배경 영역<br>
            <span style="font-size:13px;color:#94A3B8">(기존 C# 키오스크 애플리케이션)</span>
          </div>
        </div>

        <!-- Dim Overlay -->
        <div class="dim-overlay" id="dimOverlay" role="presentation"></div>

        <!-- ═══ Floating Panel 560×720 ═══ -->
        <div class="floating-panel" id="floatingPanel" role="dialog" aria-label="음성 택배 접수 연결 완료">

          <!-- Header 56px -->
          <div class="panel-header">
            <span class="panel-header__title">음성 택배 접수</span>
            <div class="panel-header__actions">
              <!-- 보안 상태: E2EE 활성 → 녹색 -->
              <div class="panel-header__icon" aria-label="보안 상태: E2EE 활성">
                <svg class="panel-header__security" viewBox="0 0 24 24" fill="none">
                  <rect x="3" y="11" width="18" height="11" rx="2" stroke="currentColor" stroke-width="1.8"/>
                  <path d="M7 11V7a5 5 0 0110 0v4" stroke="currentColor" stroke-width="1.8"/>
                  <circle cx="12" cy="16" r="1.5" fill="currentColor"/>
                </svg>
              </div>
              <!-- 연결 상태: 녹색 (연결됨) -->
              <div class="panel-header__connection" id="connectionDot" aria-label="연결 상태: 연결됨"></div>
              <button class="panel-header__close" id="btnClose" aria-label="닫기">
                <svg viewBox="0 0 24 24" fill="none">
                  <path d="M18 6L6 18M6 6l12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                </svg>
              </button>
            </div>
          </div>

          <!-- Content -->
          <div class="panel-content" id="panelContent">

            <!-- Avatar Type A — AVT-SPEAK 상태 -->
            <div class="avatar-area" id="avatarArea">
              <div class="avatar-container" id="avatarTouch" role="button" tabindex="0" aria-label="아바타 터치: TTS 재생">
                <div class="avatar-placeholder" role="img" aria-label="AI 어시스턴트 아바타, 말하기 상태">
                  <div class="avatar-placeholder__icon">
                    <svg viewBox="0 0 24 24" fill="none">
                      <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2z" fill="white" opacity="0.2"/>
                      <path d="M12 4a4 4 0 100 8 4 4 0 000-8zM12 14c-4 0-8 2-8 4v2h16v-2c0-2-4-4-8-4z" fill="white"/>
                    </svg>
                  </div>
                  <span class="avatar-placeholder__label">AI 어시스턴트</span>
                  <!-- AVT-SPEAK indicator -->
                  <div class="avatar-speak-indicator" aria-hidden="true">
                    <svg viewBox="0 0 24 24" fill="none">
                      <path d="M21 15a2 2 0 01-2 2H7l-4 4V5a2 2 0 012-2h14a2 2 0 012 2z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                  </div>
                </div>
              </div>
              <div class="avatar-bubble" id="avatarBubble">
                <p class="avatar-bubble__text" id="bubbleText"></p>
              </div>
            </div>

            <!-- 연결 완료 안내 콘텐츠 -->
            <div class="connection-complete" id="connectionComplete">
              <!-- 완료 아이콘 + 대제목 -->
              <div class="connection-complete__header">
                <div class="connection-complete__icon">
                  <svg viewBox="0 0 48 48" fill="none">
                    <circle cx="24" cy="24" r="22" fill="#22C55E" opacity="0.12"/>
                    <circle cx="24" cy="24" r="18" fill="#22C55E" opacity="0.2"/>
                    <path d="M15 24l6 6 12-12" stroke="#22C55E" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                </div>
                <h2 class="connection-complete__title">연결되었습니다!</h2>
              </div>

              <!-- 설명 텍스트 -->
              <div class="connection-complete__desc">
                <p class="connection-complete__desc-line">스마트폰과 키오스크가 안전하게 연결되었습니다.</p>
                <p class="connection-complete__desc-line">지금부터 음성으로 택배 접수를 진행합니다.</p>
              </div>

              <!-- E2EE 상태 뱃지 -->
              <div class="e2ee-badge">
                <svg class="e2ee-badge__icon" viewBox="0 0 24 24" fill="none">
                  <rect x="3" y="11" width="18" height="11" rx="2" stroke="currentColor" stroke-width="1.8"/>
                  <path d="M7 11V7a5 5 0 0110 0v4" stroke="currentColor" stroke-width="1.8"/>
                </svg>
                <span class="e2ee-badge__text">종단간 암호화 적용됨</span>
              </div>

              <!-- 자동 전환 인디케이터 -->
              <div class="auto-transition" id="autoTransition">
                <div class="auto-transition__dots">
                  <div class="auto-transition__dot"></div>
                  <div class="auto-transition__dot"></div>
                  <div class="auto-transition__dot"></div>
                </div>
                <span class="auto-transition__text" id="transitionText">자동 전환 중...</span>
              </div>
            </div>
          </div>

          <!-- Reconnection UI (WebRTC 연결 끊김 시) -->
          <div class="reconnect-overlay" id="reconnectOverlay">
            <!-- 재연결 아바타 영역 -->
            <div class="reconnect-avatar-area">
              <div class="avatar-container">
                <div class="avatar-placeholder" role="img" aria-label="AI 어시스턴트, 에러 상태" style="opacity:0.95;">
                  <div class="avatar-placeholder__icon" style="background:linear-gradient(135deg, #EF4444 0%, #F97316 100%);">
                    <svg viewBox="0 0 24 24" fill="none">
                      <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2z" fill="white" opacity="0.2"/>
                      <path d="M12 4a4 4 0 100 8 4 4 0 000-8zM12 14c-4 0-8 2-8 4v2h16v-2c0-2-4-4-8-4z" fill="white"/>
                    </svg>
                  </div>
                  <span class="avatar-placeholder__label">AI 어시스턴트</span>
                </div>
              </div>
              <div class="avatar-bubble" style="animation:none;opacity:1;">
                <p class="avatar-bubble__text">연결이 끊어졌습니다.<br>아래 방법으로 다시 연결해주세요.</p>
              </div>
            </div>

            <!-- 재연결 콘텐츠 -->
            <div class="reconnect-content">
              <div class="reconnect-warning">
                <svg class="reconnect-warning__icon" viewBox="0 0 24 24" fill="none">
                  <path d="M10.29 3.86L1.82 18a2 2 0 001.71 3h16.94a2 2 0 001.71-3L13.71 3.86a2 2 0 00-3.42 0z" stroke="#F59E0B" stroke-width="1.8" fill="#FEF3C7"/>
                  <path d="M12 9v4M12 17h.01" stroke="#F59E0B" stroke-width="2" stroke-linecap="round"/>
                </svg>
                <span class="reconnect-warning__text">스마트폰 연결이 끊어졌습니다.</span>
              </div>

              <button class="reconnect-btn" id="btnReconnectQR">
                <span class="reconnect-btn__icon">📱</span>
                QR코드로 다시 연결하기
              </button>
              <button class="reconnect-btn" id="btnReconnectPhone">
                <span class="reconnect-btn__icon">📞</span>
                전화로 연결하기
              </button>
              <button class="reconnect-btn" id="btnReconnectMic">
                <span class="reconnect-btn__icon">🎤</span>
                키오스크 마이크로 진행하기
              </button>
            </div>
          </div>

          <!-- Auto Transition Progress Bar -->
          <div class="transition-progress" id="transitionProgress">
            <div class="transition-progress__bar" id="transitionBar"></div>
          </div>

          <!-- Footer 52px -->
          <div class="panel-footer">
            <div class="panel-footer__left">
              <div class="progress-indicator" role="progressbar" aria-label="연결 완료, 1/5 단계" aria-valuenow="1" aria-valuemin="1" aria-valuemax="5">
                <div class="progress-dot progress-dot--active"></div>
                <div class="progress-dot"></div>
                <div class="progress-dot"></div>
                <div class="progress-dot"></div>
                <div class="progress-dot"></div>
              </div>
              <span class="progress-label">연결 완료</span>
            </div>
            <button class="btn-fallback" id="btnFallback" aria-label="화면으로 입력하기, 기존 터치 UI로 전환">
              화면으로 입력하기
              <svg viewBox="0 0 14 14" fill="none">
                <path d="M5 2.5L9.5 7 5 11.5" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </button>
          </div>
        </div>

        <!-- ═══ Dimension Annotations ═══ -->
        <div class="ann-panel-w">
          <span class="ann-panel-w__label">Panel 560px</span>
        </div>
        <div class="ann-panel-h">
          <span class="ann-panel-h__label">720px</span>
        </div>
        <div class="ann-margin-r">
          <span class="ann-margin-r__label">20px</span>
        </div>
        <div class="ann-header-h">
          <div class="ann-header-h__line"></div>
          <span class="ann-header-h__label">56px Header</span>
        </div>
        <div class="ann-footer-h">
          <div class="ann-footer-h__line"></div>
          <span class="ann-footer-h__label">52px Footer</span>
        </div>
        <div class="ann-kiosk-w">
          <span class="ann-kiosk-w__label">Kiosk 768px</span>
        </div>
        <div class="ann-kiosk-h">
          <span class="ann-kiosk-h__label">1024px</span>
        </div>

        <!-- Confirmation Dialog -->
        <div class="dialog-overlay" id="dialogOverlay" role="dialog" aria-modal="true" aria-label="서비스 최소화 확인">
          <div class="dialog">
            <div class="dialog__icon">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                <path d="M12 9v4M12 17h.01" stroke="#F59E0B" stroke-width="2" stroke-linecap="round"/>
                <path d="M10.29 3.86L1.82 18a2 2 0 001.71 3h16.94a2 2 0 001.71-3L13.71 3.86a2 2 0 00-3.42 0z" stroke="#F59E0B" stroke-width="1.8"/>
              </svg>
            </div>
            <h2 class="dialog__title">서비스를 종료하시겠습니까?</h2>
            <p class="dialog__desc">최소화하면 나중에 다시 이어서 진행할 수 있습니다.</p>
            <div class="dialog__actions">
              <button class="dialog__btn dialog__btn--secondary" id="btnMinimize">최소화</button>
              <button class="dialog__btn dialog__btn--primary" id="btnContinue">계속하기</button>
            </div>
          </div>
        </div>

        <!-- Toast -->
        <div class="toast" id="toast">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
            <circle cx="12" cy="12" r="10" stroke="white" stroke-width="1.5"/>
            <path d="M12 8v4M12 16h.01" stroke="white" stroke-width="1.5" stroke-linecap="round"/>
          </svg>
          <span id="toastText"></span>
        </div>

      </div>
    </div>

    <!-- ═══════════════════════════════════════════
         Spec Legend
         ═══════════════════════════════════════════ -->
    <div class="spec-legend">
      <div class="spec-legend__title">규격 범례 (Dimension Legend)</div>
      <div class="spec-legend__item">
        <span class="spec-legend__color" style="background:#EF4444"></span>
        <span class="spec-legend__text">패널 너비 (560px)</span>
      </div>
      <div class="spec-legend__item">
        <span class="spec-legend__color" style="background:#3B82F6"></span>
        <span class="spec-legend__text">패널 높이 (720px)</span>
      </div>
      <div class="spec-legend__item">
        <span class="spec-legend__color" style="background:#22C55E"></span>
        <span class="spec-legend__text">우측 여백 (20px)</span>
      </div>
      <div class="spec-legend__item">
        <span class="spec-legend__color" style="background:#F59E0B"></span>
        <span class="spec-legend__text">헤더 (56px)</span>
      </div>
      <div class="spec-legend__item">
        <span class="spec-legend__color" style="background:#8B5CF6"></span>
        <span class="spec-legend__text">푸터 (52px)</span>
      </div>
      <div class="spec-legend__item">
        <span class="spec-legend__color" style="background:#9CA3AF"></span>
        <span class="spec-legend__text">키오스크 영역 (768×1024px)</span>
      </div>
    </div>

  </div>

  <!-- ═══════════════════════════════════════════
       JAVASCRIPT
       ═══════════════════════════════════════════ -->
  <script>
    (function() {
      'use strict';

      // ── DOM References ──
      var dimOverlay = document.getElementById('dimOverlay');
      var btnClose = document.getElementById('btnClose');
      var btnFallback = document.getElementById('btnFallback');
      var dialogOverlay = document.getElementById('dialogOverlay');
      var btnMinimize = document.getElementById('btnMinimize');
      var btnContinue = document.getElementById('btnContinue');
      var toast = document.getElementById('toast');
      var toastText = document.getElementById('toastText');
      var bubbleText = document.getElementById('bubbleText');
      var avatarTouch = document.getElementById('avatarTouch');
      var reconnectOverlay = document.getElementById('reconnectOverlay');
      var connectionDot = document.getElementById('connectionDot');
      var transitionBar = document.getElementById('transitionBar');
      var transitionText = document.getElementById('transitionText');
      var autoTransition = document.getElementById('autoTransition');
      var panelContent = document.getElementById('panelContent');

      // ── State ──
      var autoTransitionTimer = null;
      var timerDuration = 3000; // 3초
      var isDisconnected = false;
      var isDialogOpen = false;
      var timerStartTime = null;
      var timerRemaining = timerDuration;

      // ── Bubble Typing Effect ──
      var bubbleFullText = '스마트폰이 연결되었습니다! 이제 편하게 말씀해주세요.';
      var charIndex = 0;
      var typingInterval = null;

      function startTyping() {
        charIndex = 0;
        bubbleText.innerHTML = '';
        typingInterval = setInterval(function() {
          if (charIndex < bubbleFullText.length) {
            bubbleText.textContent = bubbleFullText.substring(0, charIndex + 1);
            charIndex++;
          } else {
            clearInterval(typingInterval);
            // Typing complete — start auto-transition timer
            startAutoTransitionTimer();
          }
        }, 40);
      }

      // Start typing after panel animation (300ms panel + 300ms bubble delay)
      setTimeout(startTyping, 700);

      // ── Auto Transition Timer ──
      function startAutoTransitionTimer() {
        if (isDisconnected) return;

        timerStartTime = Date.now();
        timerRemaining = timerDuration;

        // Progress bar animation
        transitionBar.style.transition = 'none';
        transitionBar.style.width = '0%';
        // Force reflow
        void transitionBar.offsetWidth;
        transitionBar.style.transition = 'width ' + timerDuration + 'ms linear';
        transitionBar.classList.add('running');

        autoTransitionTimer = setTimeout(function() {
          if (!isDisconnected && !isDialogOpen) {
            console.log('[SDK] AutoTransition: SCR-K-004 → SCR-K-005');
            transitionText.textContent = '전환 완료!';
            showToast('→ SCR-K-005 (정보 수집 — 음성 입력 모드)로 전환');
          }
        }, timerDuration);
      }

      function pauseAutoTransitionTimer() {
        if (autoTransitionTimer) {
          clearTimeout(autoTransitionTimer);
          autoTransitionTimer = null;
          if (timerStartTime) {
            timerRemaining -= (Date.now() - timerStartTime);
            if (timerRemaining < 0) timerRemaining = 0;
          }
          // Pause progress bar
          var currentWidth = transitionBar.getBoundingClientRect().width;
          var parentWidth = transitionBar.parentElement.getBoundingClientRect().width;
          var pct = parentWidth > 0 ? (currentWidth / parentWidth * 100) : 0;
          transitionBar.style.transition = 'none';
          transitionBar.style.width = pct + '%';
        }
      }

      function resumeAutoTransitionTimer() {
        if (isDisconnected || timerRemaining <= 0) return;
        timerStartTime = Date.now();

        // Resume progress bar
        var currentWidth = parseFloat(transitionBar.style.width) || 0;
        transitionBar.style.transition = 'width ' + timerRemaining + 'ms linear';
        transitionBar.style.width = '100%';

        autoTransitionTimer = setTimeout(function() {
          if (!isDisconnected && !isDialogOpen) {
            console.log('[SDK] AutoTransition: SCR-K-004 → SCR-K-005');
            transitionText.textContent = '전환 완료!';
            showToast('→ SCR-K-005 (정보 수집 — 음성 입력 모드)로 전환');
          }
        }, timerRemaining);
      }

      function resetAutoTransitionTimer() {
        clearTimeout(autoTransitionTimer);
        autoTransitionTimer = null;
        timerRemaining = timerDuration;
        transitionText.textContent = '자동 전환 중...';
        transitionBar.style.transition = 'none';
        transitionBar.style.width = '0%';
        transitionBar.classList.remove('running');
        // Restart
        setTimeout(function() { startAutoTransitionTimer(); }, 100);
      }

      // ── Avatar Touch → TTS replay ──
      avatarTouch.addEventListener('click', function() {
        console.log('[TTS] "안녕하세요. 택배 접수를 도와드리겠습니다." (개인 단말 재생)');
        showToast('🔊 TTS: "안녕하세요. 택배 접수를 도와드리겠습니다."');
      });
      avatarTouch.addEventListener('keydown', function(e) {
        if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); avatarTouch.click(); }
      });

      // ── Close / Dim → Dialog ──
      btnClose.addEventListener('click', function() {
        isDialogOpen = true;
        pauseAutoTransitionTimer();
        dialogOverlay.classList.add('active');
      });

      dimOverlay.addEventListener('click', function() {
        isDialogOpen = true;
        pauseAutoTransitionTimer();
        dialogOverlay.classList.add('active');
      });

      btnMinimize.addEventListener('click', function() {
        isDialogOpen = false;
        dialogOverlay.classList.remove('active');
        console.log('[SDK] PanelModeChanged(standard → compact)');
        showToast('패널 최소화 → 컴팩트 모드');
      });

      btnContinue.addEventListener('click', function() {
        isDialogOpen = false;
        dialogOverlay.classList.remove('active');
        resumeAutoTransitionTimer();
      });

      // ── Fallback Button ──
      btnFallback.addEventListener('click', function() {
        clearTimeout(autoTransitionTimer);
        console.log('[SDK] FallbackRequested(source: "SCR-K-004", slotData: {})');
        showToast('→ SCR-F-001 (폴백 전환 안내) — 빈 슬롯 데이터 전달');
      });

      // ── Reconnection Buttons ──
      document.getElementById('btnReconnectQR').addEventListener('click', function() {
        console.log('[SDK] ReconnectRequested(method: "qr")');
        showToast('→ SCR-K-003 (QR 세션 페어링)으로 복귀');
      });

      document.getElementById('btnReconnectPhone').addEventListener('click', function() {
        console.log('[SDK] ReconnectRequested(method: "pstn")');
        showToast('→ SCR-K-003 (전화 페어링 모드)으로 전환');
      });

      document.getElementById('btnReconnectMic').addEventListener('click', function() {
        console.log('[SDK] ReconnectRequested(method: "kiosk_mic")');
        showToast('→ SCR-K-005 (정보 수집, 마이크 모드)으로 전환');
      });

      // ── Simulation: Disconnect ──
      document.getElementById('simDisconnectBtn').addEventListener('click', function() {
        if (isDisconnected) {
          // Reconnect
          isDisconnected = false;
          reconnectOverlay.classList.remove('active');
          connectionDot.style.background = 'var(--success)';
          connectionDot.style.animation = 'connectionPulse 2s ease-in-out infinite';
          document.querySelector('.panel-header__security').style.color = 'var(--success)';
          this.textContent = '연결끊김';
          resetAutoTransitionTimer();
          showToast('✅ WebRTC 연결 복원 시뮬레이션');
        } else {
          // Disconnect
          isDisconnected = true;
          clearTimeout(autoTransitionTimer);
          autoTransitionTimer = null;
          transitionBar.style.transition = 'none';
          transitionBar.style.width = '0%';
          reconnectOverlay.classList.add('active');
          connectionDot.style.background = 'var(--error)';
          connectionDot.style.animation = 'none';
          document.querySelector('.panel-header__security').style.color = 'var(--error)';
          this.textContent = '연결복원';
          showToast('⚠️ WebRTC 연결 끊김 시뮬레이션');
        }
      });

      // ── Simulation: Timer Reset ──
      document.getElementById('simResetBtn').addEventListener('click', function() {
        if (!isDisconnected) {
          resetAutoTransitionTimer();
          showToast('🔄 자동 전환 타이머 리셋 (3초)');
        }
      });

      // ── Toast ──
      function showToast(msg) {
        toastText.textContent = msg;
        toast.classList.add('active');
        setTimeout(function() { toast.classList.remove('active'); }, 2800);
      }
    })();

    // ── Spec Toggle (규격보기) ──
    (function() {
      'use strict';
      var specToggleBtn = document.getElementById('specToggleBtn');
      var kioskFrame = document.getElementById('kioskFrame');
      var specLegend = document.querySelector('.spec-legend');

      specToggleBtn.addEventListener('click', function() {
        var isActive = specToggleBtn.classList.toggle('active');
        specToggleBtn.setAttribute('aria-pressed', isActive ? 'true' : 'false');

        if (isActive) {
          kioskFrame.classList.add('specs-visible');
          specLegend.classList.add('visible');
          specToggleBtn.innerHTML = '<svg viewBox="0 0 20 20" fill="none"><path d="M2 4h4M14 4h4M2 4v2M18 4v2M2 16h4M14 16h4M2 16v-2M18 16v-2M4 2v4M4 14v4M16 2v4M16 14v4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/></svg> 규격숨기기';
        } else {
          kioskFrame.classList.remove('specs-visible');
          specLegend.classList.remove('visible');
          specToggleBtn.innerHTML = '<svg viewBox="0 0 20 20" fill="none"><path d="M2 4h4M14 4h4M2 4v2M18 4v2M2 16h4M14 16h4M2 16v-2M18 16v-2M4 2v4M4 14v4M16 2v4M16 14v4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/></svg> 규격보기';
        }
      });
    })();
  </script>
</body>
</html>
